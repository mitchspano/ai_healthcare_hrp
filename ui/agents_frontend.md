```markdown
# agents_frontend.md
> **Repo:** `t1d-chat-ui` (Vite + React)  
> **Purpose:** Lightweight chat UI that talks to the FastAPI backend (`/chat`) for the T1D Agent MVP.

---

## 1. Directory Overview

```

t1d-chat-ui/
‚îú‚îÄ index.html            # HTML shell (Tailwind CDN injected)
‚îú‚îÄ .env                  # VITE\_API\_URL=[http://localhost:8000/chat](http://localhost:8000/chat)
‚îú‚îÄ src/
‚îÇ   ‚îú‚îÄ main.jsx          # React entry (Vite)
‚îÇ   ‚îî‚îÄ App.jsx           # Chat component (state, fetch, bubbles)
‚îú‚îÄ package.json          # Vite + React deps only
‚îî‚îÄ vite.config.js        # auto-generated by Vite

````

---

## 2. How the front-end works

| Step | What happens | File / function |
|------|--------------|-----------------|
| 1Ô∏è‚É£ | User types message & hits **Send** | `App.jsx ‚Üí send()` |
| 2Ô∏è‚É£ | POST `{subject_id,text}` to `VITE_API_URL` (defaults to `http://localhost:8000/chat`) | `fetch()` in `send()` |
| 3Ô∏è‚É£ | While awaiting response ‚Üí `loading=true` disables input | state hook |
| 4Ô∏è‚É£ | Backend returns `{reply: "..."};` message pushed into `history` | `setHistory()` |
| 5Ô∏è‚É£ | React maps `history` ‚Üí `<Bubble>` components; auto-scrolls to bottom | `<Bubble>` + `useEffect` |
| 6Ô∏è‚É£ | Errors caught ‚Üí yellow bubble `"‚ö†Ô∏è backend error"` | `catch` block |

**Styling:** Tailwind CDN, no build-time config ‚Üí classes work immediately.

---

## 3. Key Components

### `Bubble`
Small functional component:
```jsx
function Bubble({ who, text }) {
  const style =
    who === "user"
      ? "bg-blue-600 text-white ml-auto"
      : "bg-gray-200 text-gray-900";
  return <div className={`rounded-lg px-3 py-2 max-w-xs ${style}`}>{text}</div>;
}
````

### `send()` (in `App.jsx`)

```jsx
const send = async () => {
  if (!input.trim() || loading) return;
  setHistory(h => [...h, { who: "user", text: input }]);
  setInput(""); setLoading(true);
  try {
    const res = await fetch(API_URL, {
      method: "POST", headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ subject_id: "Subject 9", text: input })
    });
    const data = await res.json();
    setHistory(h => [...h, { who: "assistant", text: data.reply }]);
  } catch {
    setHistory(h => [...h, { who: "assistant", text: "‚ö†Ô∏è backend error, try again." }]);
  } finally { setLoading(false); }
};
```

---

## 4. Dev Workflow

| Task             | Command                              | Notes                                                |
| ---------------- | ------------------------------------ | ---------------------------------------------------- |
| Install deps     | `npm install`                        | after cloning                                        |
| Run dev server   | `npm run dev`                        | opens [http://localhost:5173](http://localhost:5173) |
| Point to backend | edit `.env` or export `VITE_API_URL` | backend default port 8000                            |
| Build for prod   | `npm run build`                      | output in `dist/`                                    |

---

## 5. Current backend contract (echo)

```
POST /chat
{
  "subject_id": "Subject 9",
  "text": "Hello"
}
‚Üí { "reply": "(echo) You said: Hello" }
```

> **Next backend milestones**
> ‚Ä¢ Replace echo with OpenAI tool-calling agent.
> ‚Ä¢ Add CORS (already in backend snippet).
> ‚Ä¢ Add `/alerts` SSE/WebSocket for proactive messages.

---

## 6. TODOs / Nice-to-haves

* [ ] Loading spinner or ‚Äútyping‚Ä¶‚Äù indicator.
* [ ] Subject selector dropdown.
* [ ] Auto-focus input after send.
* [ ] Tailwind switch to local build if custom theme needed.
* [ ] Unit tests with React Testing Library (mock fetch).

---

## 7. Quick setup from scratch (for future agents)

```bash
# üñ•Ô∏è  clone + run
git clone https://github.com/<org>/ai_healthcare_hrp.git
cd ai_healthcare_hrp/t1d-chat-ui
npm install
echo 'VITE_API_URL=http://localhost:8000/chat' > .env
npm run dev
# backend in separate shell:
uvicorn back_end:app --reload --port 8000
```

This document should give any code-gen agent or new dev enough context to navigate the front-end, understand the chat flow, and extend or refactor with confidence.

```
```
